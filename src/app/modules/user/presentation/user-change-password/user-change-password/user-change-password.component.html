<div class="p-4 flex flex-col gap-4">
  <p-breadcrumb [model]="items" />

  <p-card>
    <div class="flex flex-col gap-4">
      <div>
        <h2 class="text-xl font-semibold">Cambiar contraseña</h2>
        <p class="text-sm text-gray-600">Al dar click en "Enviar código" se enviará un código al correo proporcionado. Llene los campos para completar su cambio de contraseña</p>
      </div>

      <form [formGroup]="form" class="flex flex-col gap-3">
        <div class="flex flex-col gap-1">
          <span class="text-sm font-medium">Correo:</span>
          <p class="text-base font-semibold">{{ email() || 'Sin correo' }}</p>
        </div>

        <div class="flex items-center gap-2">
          <p-button
            label="Enviar código"
            icon="pi pi-send"
            (onClick)="sendCode()"
            [loading]="sendingCode"
            [disabled]="countdown() > 0"></p-button>
          <span class="text-sm text-gray-600" *ngIf="countdown() > 0">Reintenta en {{ countdown() }}s</span>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div class="flex flex-col gap-2">
            <label for="code" class="text-sm font-medium">Código</label>
            <input id="code" pInputText formControlName="code" maxlength="6" placeholder="Código recibido" />
            <small class="text-red-500" *ngIf="form.get('code')?.invalid && form.get('code')?.touched">Requerido (6 dígitos)</small>
          </div>
          <div class="flex flex-col gap-2">
            <label for="newPassword" class="text-sm font-medium">Nueva contraseña</label>
            <p-password inputId="newPassword" formControlName="newPassword" [toggleMask]="true" [feedback]="false" placeholder="Nueva contraseña" />
            <small class="text-red-500" *ngIf="form.get('newPassword')?.invalid && form.get('newPassword')?.touched">Mínimo 6 caracteres</small>
          </div>
        </div>

        <div class="flex flex-col gap-2">
          <label for="confirmPassword" class="text-sm font-medium">Confirmar contraseña</label>
          <p-password inputId="confirmPassword" formControlName="confirmPassword" [toggleMask]="true" [feedback]="false" placeholder="Repite la contraseña" />
          <small class="text-red-500" *ngIf="form.get('confirmPassword')?.touched && form.value.newPassword !== form.value.confirmPassword">Las contraseñas no coinciden</small>
        </div>

        <div class="flex justify-end">
          <p-button
            label="Cambiar contraseña"
            icon="pi pi-check"
            (onClick)="changePassword()"
            [disabled]="!codeSent()"
            [loading]="resetting"></p-button>
        </div>
      </form>
    </div>
  </p-card>
</div>
